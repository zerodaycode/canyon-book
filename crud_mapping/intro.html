<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CRUD and Mapping operations - The Canyon&#x27;s Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../getting_started/getting_started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting_started/initial_setup.html"><strong aria-hidden="true">1.1.</strong> Initial setup</a></li><li class="chapter-item expanded "><a href="../getting_started/the_configuration_file.html"><strong aria-hidden="true">1.2.</strong> The configuration file</a></li><li class="chapter-item expanded "><a href="../getting_started/configuring_the_database.html"><strong aria-hidden="true">1.3.</strong> The database config</a></li></ol></li><li class="chapter-item expanded "><a href="../canyon_entities.html"><strong aria-hidden="true">2.</strong> Canyon Entity</a></li><li class="chapter-item expanded "><a href="../crud_mapping/intro.html" class="active"><strong aria-hidden="true">3.</strong> CRUD and Mapping operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../crud_mapping/quick_note.html"><strong aria-hidden="true">3.1.</strong> Quick note</a></li><li class="chapter-item expanded "><a href="../crud_mapping/select.html"><strong aria-hidden="true">3.2.</strong> Select</a></li><li class="chapter-item expanded "><a href="../crud_mapping/insert.html"><strong aria-hidden="true">3.3.</strong> Insert</a></li><li class="chapter-item expanded "><a href="../crud_mapping/update.html"><strong aria-hidden="true">3.4.</strong> Update</a></li><li class="chapter-item expanded "><a href="../crud_mapping/delete.html"><strong aria-hidden="true">3.5.</strong> Delete</a></li><li class="chapter-item expanded "><a href="../crud_mapping/foreign_keys.html"><strong aria-hidden="true">3.6.</strong> Foreign Keys</a></li></ol></li><li class="chapter-item expanded "><a href="../querybuilder.html"><strong aria-hidden="true">4.</strong> The QueryBuilder</a></li><li class="chapter-item expanded "><a href="../the_migrations.html"><strong aria-hidden="true">5.</strong> The migrations</a></li><li class="chapter-item expanded "><a href="../real_world_example.html"><strong aria-hidden="true">6.</strong> A real world example</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Canyon&#x27;s Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="crud-and-mapping-operations"><a class="header" href="#crud-and-mapping-operations">CRUD and Mapping Operations</a></h1>
<ul>
<li><a href="#crud-and-mapping-operations">CRUD and Mapping Operations</a>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-canyoncrud-and-canyonmapper-derive-macros">The <code>CanyonCrud</code> and <code>CanyonMapper</code> derive macros</a></li>
<li><a href="#the-asynchronous-behavior-of-canyon">The asynchronous behavior of <code>Canyon</code></a></li>
<li><a href="#the-datasource-concept">The <code>datasource</code> concept</a>
<ul>
<li><a href="#specifying-datasources">Specifying Datasources</a></li>
<li><a href="#default-datasources">Default Datasources</a></li>
</ul>
</li>
<li><a href="#next-steps">Next steps</a></li>
</ul>
</li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p><a href="#introduction">(back to top)</a></p>
<p>The primary purpose of <code>Canyon</code> is to facilitate database querying and retrieval of data. Writing raw SQL statements every time data is needed can be tedious, error-prone, and challenging to debug. Therefore, <code>Canyon</code> provides a solution to make the developer's life easier by automatically generating the desired queries.</p>
<p>As described in previous chapter, the macros <code>#[canyon_entity]</code> and <code>#[primary_key]</code> describe an entity and the primary key, respectively. In Canyon's common language, an entity represents a Rust type that models a real world object. It is a term used to refer to a type that maps against a database table. <code>Canyon</code> recognizes this and generate an implementation block with methods and associated functions to allow the type to communicate with the database. </p>
<p>Consider the following Rust type declaration:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[canyon_entity]
pub struct League {
    #[primary_key]
    pub id: i32,
    pub ext_id: i64,
    pub slug: String,
    pub name: String,
    pub region: String,
    pub image_url: String
}
<span class="boring">}
</span></code></pre></pre>
<p>This struct represents the data of a professional competitive league from the <code>League of Legends</code> MOBA obtained from the <code>LolEsports API</code>. Suppose there is a web application that requests this information. The first thing that can be done is store it in the database and then serve it to the main application. Which could be, for instance, a mobile front-end application.</p>
<p>Methods will have to be implemented for saving, retrieving, and updating data...</p>
<p>To accomplish these tasks, <code>Canyon</code> will support the development by reducing the extensive amount of Rust code required to perform such database operations.</p>
<h2 id="the-canyoncrud-and-canyonmapper-derive-macros"><a class="header" href="#the-canyoncrud-and-canyonmapper-derive-macros">The <code>CanyonCrud</code> and <code>CanyonMapper</code> derive macros</a></h2>
<p><a href="#introduction">(back to top)</a></p>
<p>Canyon provides two powerful macros to simplify the developer's work:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(CanyonCrud, CanyonMapper)]
<span class="boring">}
</span></code></pre></pre>
<p>These two derive macros work together and are essential for communicating with the database. They will implement the following traits on the type:</p>
<ul>
<li><code>CanyonCrud</code> is responsible for generating the CRUD methods for interacting with the database;</li>
<li><code>CanyonMapper</code> is responsible for serializing/deserializing the data as it sends/receives messages with the database;</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(CanyonCrud, CanyonMapper)]
#[canyon_entity]
pub struct League {
    #[primary_key]
    pub id: i32,
    pub ext_id: i64,
    pub slug: String,
    pub name: String,
    pub region: String,
    pub image_url: String
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="the-asynchronous-behavior-of-canyon"><a class="header" href="#the-asynchronous-behavior-of-canyon">The asynchronous behavior of <code>Canyon</code></a></h2>
<p><a href="#introduction">(back to top)</a></p>
<p>It should be noted that every <code>Canyon</code> action requires the usage of a <code>.await</code> expression. This is because every operation in <code>Canyon</code> is designed to be asynchronous, which means that the result must be awaited in order to be obtained.</p>
<p>It is also important to remember that from this point forward, every action with <code>Canyon</code> that leads to  the execution of a database query must be followed by the <code>await</code> instruction. This is because futures are <em>lazy by default</em>, which means that they will <em>not be consumed unless they are awaited</em>.</p>
<p>If you are not familiar with the concept of asynchronous programming, we recommend taking a look at <a href="https://rust-lang.github.io/async-book/03_async_await/01_chapter.html">The Rust async book</a>. This resource can provide valuable insight about asynchronous programming.</p>
<h2 id="the-datasource-concept"><a class="header" href="#the-datasource-concept">The <code>datasource</code> concept</a></h2>
<p><a href="#introduction">(back to top)</a></p>
<p>Before we proceed, let's discuss the concept of <code>datasource</code> in Canyon.</p>
<p>A <code>datasource</code> in Canyon refers to the channel that connects the framework with a specific database. A user may have multiple datasources, even if they use different database engines. With Canyon, you can query one database in a statement and then query a completely different one in the next statement.</p>
<h3 id="specifying-datasources"><a class="header" href="#specifying-datasources">Specifying Datasources</a></h3>
<p><a href="#introduction">(back to top)</a></p>
<p>It is worth noting that all CRUD operations, whether they are a method from your type or an associated function, will have a duplicate ending with <code>_datasource</code>. For instance, the <code>::find_all()</code> operation will have a replica called <code>::find_all_datasource(datasource_name: &amp;str)</code>. In this duplicate, <code>datasource_name</code> matches one of the datasource names defined in the configuration file.</p>
<h3 id="default-datasources"><a class="header" href="#default-datasources">Default Datasources</a></h3>
<p><a href="#introduction">(back to top)</a></p>
<p><code>Canyon</code> takes the first declared datasource as the default one. Therefore, you may find code that uses <code>::find_all()</code> without the need to specify a datasource, as <code>Canyon</code> will use the default directly in the queries.</p>
<p>To avoid duplication in the next chapters, it is essential to remember that there will be a <code>_datasource</code> alternative for every CRUD operation. This can be used to specify a datasource when the default is not the target.</p>
<h2 id="next-steps"><a class="header" href="#next-steps">Next steps</a></h2>
<p><a href="#introduction">(back to top)</a></p>
<p>In this chapter, we have created a new type that is capable of querying the database and properly serializing/deserializing messages as needed.</p>
<p>However it is important to explore what Canyon is really capable of doing with these annotations. The following chapters will discuss more in-depth about each of the CRUD operations...</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../canyon_entities.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../crud_mapping/quick_note.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../canyon_entities.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../crud_mapping/quick_note.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
